---
title: "analysis.rmd"
output: pdf_document
date: "2025-12-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, comment=NA}
# packages
library(ggplot2)
library(dplyr)
library(car)
library(caret)
library(reshape2)
library(olsrr)
```

```{r}
df <- read.csv("main.csv")
df <- na.omit(df)
head(df)
```

# Log-transformation of Data
```{r}
df <- df[df$MP > 20, ]
df$log_salary <- log(df$avg_salary_millions + 1)
```

# Initial Model Creation
```{r}
# need to change to sqrt_sal now
initial_model <- lm(log_salary ~ MP + PTS + FG_pct + FTA + TRB + AST + stocks + Value_Billions + (PTS * FTA), data = df)
summary(initial_model)
```
# VIF Analysis
```{r}
vif_values <- vif(initial_model)
print(vif_values)

# high vifs detected, remove
vif_less <- lm(log_salary ~ MP + PTS + FG_pct + FTA + TRB + AST + stocks + Value_Billions, data = df)
print(vif(vif_less))
```

# Stepwise
```{r}
ols_step_both_p(vif_less,p_ent=0.15,p_rem=0.15,details=T)
```

# New Model as a Result of Test
```{r}
quant <- lm(log_salary ~ PTS + MP + stocks, data = df)
summary(quant)
```

# Adding Qualitative Predictors
```{r}
quant_and_qual <- lm(log_salary ~ PTS + MP + stocks + awards_1 + awards_2plus + Age_22_26 + Age_27_31 + Age_32_34 + Age_35_plus + Pos_PF + Pos_PG + Pos_SF + Pos_SG, data = df)
summary(quant_and_qual)
```

# ANOVA Test for reduced model (Awards)
```{r}
reduced_awards <- lm(log_salary ~ PTS + MP + stocks + Age_22_26 + Age_27_31 + Age_32_34 + Age_35_plus + Pos_PF + Pos_PG + Pos_SF + Pos_SG, data = df)
anova(reduced_awards, quant_and_qual)
```

# ANOVA Test for reduced model (Age)
```{r}
reduced_age <- lm(log_salary ~ PTS + MP + stocks + awards_1 + awards_2plus + Pos_PF + Pos_PG + Pos_SF + Pos_SG, data = df)
anova(reduced_age, quant_and_qual)
```

# ANOVA Test for reduced model (Pos)
```{r}
reduced_pos <- lm(log_salary ~ PTS + MP + stocks + awards_1 + awards_2plus + Age_22_26 + Age_27_31 + Age_32_34 + Age_35_plus, data = df)
anova(reduced_pos, quant_and_qual)
```

# Final Model
```{r}
final <- lm(log_salary ~ PTS + MP + stocks + Age_22_26 + Age_27_31 + Age_32_34 + Age_35_plus, data = df)
summary(final)
```

# Confidence Intervals
```{r}
conf <- confint(final, level = 0.95)
conf
```

# K-Fold Cross Validation
```{r}
cv_model <- train(
  log_salary ~ PTS + MP + stocks + Age_22_26 + Age_27_31 + Age_32_34 + Age_35_plus, data = df,
  method = "lm",
  trControl = trainControl(method = "cv", number = 5)
)

# display results
print(cv_model)
```
# Assumption Plots
```{r}
#store residuals from the model
finres<-residuals(final)
sum(finres)
mean(finres)

#Residuals Plots of explanatory variables vs residuals
residualPlots(final,tests=F)

#Residual vs Fitted and QQ plot
plot(final, which=c(1,2))

#histogram of residuals
hist(finres)
```

# Residual Analysis
```{r}
# Cooks Distance Thresholds
plot(final,which=4)

# Leverage vs Studentized Residuals
influencePlot(final,fill=F)

# Deleted Studentized Residuals vs Predicted values
ols_plot_resid_stud_fit(final)
```

# remove obs 86 and 154 (work in progress)
```{r}
df <- df[-c(86, 154), ]
```
